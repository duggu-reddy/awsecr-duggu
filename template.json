{
	"Parameters": {
		"Cluster": {
			"Type": "String",
			"Default": "poc-cicd-containers"
		},
		"DesiredCount": {
			"Type": "String",
			"Default": "2"
		},
		"Role": {
			"Type": "String",
			"Default": "ecsTaskExecutionRole"
		},
		"TargetGroupArn": {
			"Type": "String",
			"Default": "arn:aws:elasticloadbalancing:us-west-2:802878444238:loadbalancer/app/ext-poc-container-alb/ad08ee3b17e9db16"
		},
		"Image": {
			"Type": "String",
			"Default": "node"
		}
	},
	"Resources": {
		"Services": {
			"Type": "AWS::ECS::Service",
			"Properties": {
				"Cluster": { "Ref" : "Cluster" },
				"DesiredCount": 2,
				"NetworkConfiguration": {
					"AwsvpcConfiguration": {
						"AssignPublicIp": "ENABLED",
						"Subnets": [
							"subnet-09f220c0a8c063d85"
						]
					}
				},
				"TaskDefinition": {"Ref":"TaskDefinition"},
				"LaunchType": "FARGATE",
				"LoadBalancers": [
					{
						"ContainerName": "node",
						"ContainerPort": 80,
						"TargetGroupArn": { "Ref" : "TargetGroupArn"}
					}
				]
			}
		},
		"TaskDefinition": {
			"Type": "AWS::ECS::TaskDefinition",
			"Properties": {
				"Family": "Service",
				"Cpu": 256,
				"Memory": 512,
				"NetworkMode": "awsvpc",
				"ExecutionRoleArn": {"Ref" : "Role"},
				"RequiresCompatibilities": [
					"FARGATE"
				],
				"ContainerDefinitions": [
					{
						"Name": "node",
						"Image": { "Ref" : "Image"},
						"Memory": 512,
						"PortMappings": [
							{
								"ContainerPort": 80
							}
						]
					}
				]
			}
		}
	}
}
